<%=image_tag( "treeview/plus.gif", :alt => "+", :height=>"15", :id => "maximise", :style=>"float:right")%>
<%=image_tag( "treeview/minus.gif", :alt => "-", :height=>"15", :id => "minimise", :style=>"float:right")%>
<%=theading("listing", :model=>"translation", :count=>10) %>

<%full_key_display='none'%>
<%wrapped_key_display='table_cell'%>
<%short_key_display='table-cell'%>

<button id="showHideCriteria" type='button'>x</button>
<div id='criteria' class="criteria" >
  <!-- Use form_tag here because we are not going to work with a model. form_tag doesn't work with formtastic either -->
  <%= form_tag translations_path, :method => 'get', :class=>'formtastic' do %>
  <!--%= semantic_form_for translations_path, :method => 'get' do |f| % -->
    <!--%=f.inputs do%-->
    <%= hidden_field_tag :direction, params[:direction] %>
    <%= hidden_field_tag :sort, params[:sort] %>
    
    <fieldset class="inputs">
      <ol>
      <li class="string optional" id="translation_language_id_input"><label for="criterion_language_id", class="criteria-label" ><%=tlabel("iso_code", "translation")%></label>
           <%=select_tag(  :operator_iso_code, options_for_select(operators_2_options(equal_operator), params[:operator_iso_code]),{:include_blank=> false,:class=>'criteria-operators-select', :readonly=>true} )%> 
           <!-- < %=text_field_tag( :criterion_language_id, params[:criterion_language_id])%> -->
           <%=select_tag( :criterion_iso_code, options_from_collection_for_select(TranslationLanguage.translators_language_select(current_user), "iso_code","full_name", params[:criterion_iso_code]), {:include_blank=> true})%>
           <!--%=select_tag( :criterion_iso_code, options_from_collection_for_select(TranslationLanguage.all, "iso_code","name", params[:criterion_iso_code]), {:include_blank=> false})% -->
           <!--%binding.pry%-->
           <!--%=f.semantic_errors :translations_upload_id %--> 
      </li>  
      <li class="string optional" id="translation_language_id_input"><label for="criterion_language_id", class="criteria-label" ><%=tlabel("calmapp_version", "translation")%></label>
           <%=select_tag(  :operator_cav_id, options_for_select(operators_2_options(equal_operator), params[:operator_cav_id]),{:include_blank=> false,:class=>'criteria-operators-select', :readonly=>true} )%> 
           <!-- < %=text_field_tag( :criterion_language_id, params[:criterion_language_id])%> -->
           <%=select_tag( :criterion_cav_id, options_from_collection_for_select(CalmappVersion.all, "id","name", params[:criterion_cav_id]), {:include_blank=> true})%>
           <!--%=f.semantic_errors :criterion_cav_id % -->  
      </li>
      
       <li class="string optional" id="translation_dot_key_code_input"><label for="criterion_dot_key_code", class="criteria-label" ><%=tlabel("dot_key_code", "translation")%></label>
           <%=select_tag(  :operator_dot_key_code, options_for_select(operators_2_options(Translation.search_dot_key_code_operators), params[:operator_dot_key_code]),{:include_blank=> true,:class=>'criteria-operators-select', :readonly=>true} )%> 
           
           <%=text_field_tag( :criterion_dot_key_code, params[:criterion_dot_key_code])%>   
      </li> 
       <li class="string optional" id="translation_translation_input"><label for="criterion_translation", class="criteria-label" ><%=tlabel("translation", "translation")%></label>
           <%=select_tag(  :operator_translation, options_for_select(operators_2_options(Translation.search_translation_operators), params[:operator_translation]),{:include_blank=> true,:class=>'criteria-operators-select', :readonly=>true} )%> 
           <%=text_field_tag( :criterion_translation, params[:criterion_translation])%>   
      </li>
    
     </ol> 
   </fieldset>
   <!--%end%-->  
      <%= submit_tag "Search", :name => nil %>
    
  <%end%>

</div>
<!-- < % if Translation.count==0 then %>
  < %=tflash( "no_records_found", :warning)%><br/>
< %  else %> -->

<%= twill_paginate %>
<table class="data" style="table-layout: fixed; width: 100%">
  <tr class="dataheader">

    

    <!--th class ="dataheader" style="display:< %=full_key_display%>;"> <%=tlabel('dot_key_code', 'translation') %></th-->
    <th class ="dataheader" style="display:<%=wrapped_key_display%>;  width:20%;"><%=tlabel('dot_key_code', 'translation') %></th>
    <th class ="dataheader" ><%=tlabel('en_translation', 'translation') %></th>
    <!--th class ="dataheader" style="display:<%=short_key_display%>;" ><%=tlabel('dot_key_code', 'translation') %></th -->
   
    <th class ="dataheader"><%= (@translations.empty? ? '' : @translations[0].attributes["language"] + " ") + tlabel('translation', 'translation') %></th>
     
    <!--th class="linkheader"></th>
    <th class="linkheader"></th-->
    
  </tr>
<style>
  .ok{
    color:red;
    font-size:100%;
    
  }  
</style>

  
<% cell_class = "data" %>
<% link_cell_class="link"%>  
<% editable_cell_class = "best_in_place"%>
<!-- < % i = 0 %>  -->
<% @translations.each do |translation| %>

  <tr class = "<%= cycle('dataeven', 'dataodd') %>" >
  
      
 
      
      <td class="<%= cell_class%>" style="word-wrap: break-word;" ><span style="max-width:20px;"><%= translation.dot_key_code %></span></td>
      <!--td class="< %= cell_class %>" style="display:< %=wrapped_key_display%>;">< %= dot_key_code_wrapped(translation.dot_key_code) %></td -->
      <!--td class="< %= cell_class %>" style="display:< %=short_key_display%>; ">< %= dot_key_code_last_key(translation.dot_key_code) %></td -->
<!-- It seems like best_in_place needs to work with an instance variable so we need to make things a bit more complicated here below-->
      <td class="<%= cell_class%>" style="max-width:40%;" ><%= editor_date_time_select?(translation.attributes) ? english_date_format_example(translation.attributes) : translation.attributes["en_translation"] %></td>
      <td style="max-width:40%;">
        <%= best_in_place_if  best_in_place?(translation.attributes), translation, :translation, :path => translation_path(translation.id),
             :type=> input_control(translation.attributes), :collection=> collection?(translation.attributes), 
             :ok_button=>"Save", :ok_button_class=> "ok", :cancel_button=>"Cancel", :cancel_button_class => "cancel",
             :nil=>"Click to edit", :html_attrs=> html_attrs(translation.attributes)  %>
      </td>
    
  <!-- <td class="< %= link_cell_class %>">< %= tlink_to  'edit', edito_translation_path + '?dot_key_code_no_lang=' +dot_key_code_no_lang(translation.dot_key_code) %></td> -->
    <!-- <td class="< %= link_cell_class %>">< %= tlink_to 'destroy',  translation , :confirm => 'delete.are_you_sure', :model => "translation", :value=>('Index: '+ translation.dot_key), :method => :delete %></td> -->
  </tr>
  <!-- >< % i+=1%> -->
<% end %>
</table>
<%= twill_paginate %>
<script>
  $().ready(function(){
    $(".ok").click(function(){
      console.log("ok button");
      console.log($(this).css());
      return false;
    });
    $('span').click(function(){
      console.log( "in span");
      //$(this).find(".ok").value
      //return false;
    });
  });
</script>
<script type="text/javascript">
/*
 * Script enlarges and restores editing index for translatiosn
 */
console.log("In script");
  var maximiseSelector = 'img#maximise';
  var minimiseSelector = 'img#minimise'; 
  
  var headerDiv ='div#appheader';
  var appMenuSelector = 'td#appmenutd';
  var appMainSelector ='#appmaintd';
  var appMainContainerDivSelector = '#container';
  $().ready(function(){
    //console.log("ready");
    $(maximiseSelector).show();
    $(minimiseSelector).hide();
    
  });  
  $(maximiseSelector).click(function(){
    toggleHeaderMenu();
    toggleMaxMinImages();
  });
  
  $(minimiseSelector).click(function(){
    
    toggleHeaderMenu();
    toggleMaxMinImages();
  });
  var toggleHeaderMenu = function(){
    $(headerDiv).toggle();
    $(appMenuSelector).toggle();
  }
  var toggleMaxMinImages = function(){
    $(maximiseSelector).toggle();
    $(minimiseSelector).toggle();
  }
  var toggleContainerPadding =function(){
    padding = $(appMainContainerDivSelector).css("padding");
    if(padding == '0'){
      $(appMainContainerDivSelector).css("padding", "20px 40px");
    } else{
      padding = '0';
    }
  }
</script>

<script type="text/javascript">
//This script  handles showing and hiding selection criteria
  $().ready(function(){
    //Set the initial text of the button
    $("#showHideCriteria").html(criteriaVisibleText);
    if( <%= @translations.count==0 %>){
      toggleCriteria();
    }
    
    $("#showHideCriteria").click(function(){
      //alert("Test");
      
      toggleCriteria();
      
    }); //end click
  });//end ready
  var   criteriaHiddenText = "<%=t($FA +'show_something', :something=>t($SC))%>";
  var   criteriaVisibleText = "<%=t($FA +'hide_something', :something=>t($SC))%>";
  function toggleCriteria(){
    
    if($("#criteria").is(':visible')){ 
        $("#showHideCriteria").html(criteriaHiddenText);
    }else{
        $("#showHideCriteria").html(criteriaVisibleText);
        console.log("show");
    }
    // toggle has to be after setting button text otherwise is(':visible') will not work properly
    $("#criteria").slideToggle('slow');  
  }
  
</script>
<script type="text/javascript"> 
//This script sets up inplace editing
  $().ready(function(){
    $('.best_in_place').best_in_place();
  });
</script>